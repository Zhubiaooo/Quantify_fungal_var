library(openxlsx)
# Soil sample grouping information
Field_group = read.xlsx("all_field_data.xlsx", sheet = "Field_group(all species)11", rowNames = T, colNames = T)
Field_group$Sample_ID = rownames(Field_group)

# Soil sample abundance information
Field_otu_row2 = read.xlsx("Field_data_asv.xlsx", sheet = "row_otu", colNames = T, rowNames = T)
Field_otu_row = Field_otu_row[,rownames(Field_group)]
Field_otu_row[1:6,1:6]

## checking
rownames(Field_group) %in% colnames(Field_otu_row)

## Tax INFORMATION
tax_default <- Field_otu_row2[,(387:394)]

library(microeco)
library(mecodev)
data_default <- microtable$new(sample_table = Field_group,otu_table = Field_otu_row, tax_table = tax_default)
print(data_default)
data_default$sample_table
data_default$tidy_dataset() 
print(data_default)
data_default$sample_sums()%>% range

set.seed(1234)
data_default$rarefy_samples(sample.size = 9477)
data_default$sample_sums()%>% range
print(data_default)
fungi_Flattening <- data_default$otu_table
fungi_Flattening[1:5,1:5]

# Data Transformation
Field_group$Wcont = sqrt(Field_group$Wcont)
Field_group$Soil_N = sqrt(Field_group$Soil_N)
Field_group$Phylo_Di_sp = log10(Field_group$Phylo_Di_sp)
Field_group$Funct_Di_sp = log10(Field_group$Funct_Di_sp)
Field_group$Years = as.factor(Field_group$Years)
Field_group$Site = as.factor(Field_group$Site)
Field_group = Field_group[colnames(fungi_Flattening), ] 
unique(Field_group$Species)




